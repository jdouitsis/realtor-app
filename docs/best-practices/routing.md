# Routing Best Practices

Patterns for type-safe routing with TanStack Router.

- [Routing Best Practices](#routing-best-practices)
  - [Type-Safe URL Building](#type-safe-url-building)
  - [Typed Search Params](#typed-search-params)
  - [Accessing Route Context](#accessing-route-context)
  - [Link Component](#link-component)
  - [Programmatic Navigation](#programmatic-navigation)
  - [Type-Safe Route Paths in Config](#type-safe-route-paths-in-config)
  - [Summary](#summary)

## Type-Safe URL Building

When building URLs programmatically (e.g., for redirects, clipboard copy), use `router.buildLocation()` instead of string concatenation.

**Bad:**

```typescript
const redirectUrl = `/clients/onboarding?realtorId=${user.id}`;
```

**Good:**

```typescript
import { router } from "@/router";

const { href: redirectUrl } = router.buildLocation({
  to: "/clients/onboarding",
  search: { realtorId: user.id },
});
```

TypeScript will error if:

- The route path doesn't exist
- Search params don't match the route's `validateSearch` schema
- Param names are misspelled

## Typed Search Params

Define search params with `validateSearch` on routes. This enables type checking for both reading and building URLs.

```typescript
// routes/_authenticated/clients/onboarding.tsx
import { createFileRoute } from "@tanstack/react-router";
import { z } from "zod/v4";

const searchSchema = z.object({
  realtorId: z.string().uuid(),
  tab: z.enum(["info", "documents"]).optional(),
});

export const Route = createFileRoute("/_authenticated/clients/onboarding")({
  validateSearch: searchSchema,
  component: OnboardingPage,
});
```

**Important:** Search params are only type-safe when `validateSearch` is defined on the target route. Without it, `search` accepts any object and `useSearch()` returns `unknown`.

## Accessing Route Context

Use `getRouteApi()` to access route context and search params with full type safety. This is preferred over generic hooks like `useParams()` or `useSearch()`.

```typescript
import { getRouteApi } from "@tanstack/react-router";

// For routes with search params
const onboardingRouteApi = getRouteApi("/_authenticated/clients/onboarding");

export function OnboardingPage() {
  // Fully typed - TS knows realtorId exists from validateSearch
  const { realtorId } = onboardingRouteApi.useSearch();
  // ...
}

// For routes with context
const newClientRouteApi = getRouteApi("/_authenticated/clients/new");

export function NewClientForm() {
  // Fully typed based on route's context
  const { user } = newClientRouteApi.useRouteContext();
  // ...
}
```

## Link Component

The `Link` component provides type-safe navigation. TypeScript validates `to` and `search` props.

```tsx
import { Link } from "@tanstack/react-router";

// Type-safe - TS validates route path and search params
<Link to="/clients/onboarding" search={{ realtorId: user.id }}>
  View Onboarding
</Link>

// Simple navigation
<Link to="/clients">View All Clients</Link>
```

For routes with path params (e.g., `/clients/$clientId`), use the `params` prop:

```tsx
<Link to="/clients/$clientId" params={{ clientId }}>
  View Client
</Link>
```

## Programmatic Navigation

Use `router.navigate()` for programmatic navigation with type safety.

```typescript
import { router } from "@/router";

// Navigate with search params
void router.navigate({
  to: "/otp",
  search: { redirect: currentUrl },
});

// Simple navigation
void router.navigate({ to: "/dashboard" });
```

For routes with path params, use the `params` option:

```typescript
void router.navigate({
  to: "/clients/$clientId",
  params: { clientId },
});
```

## Type-Safe Route Paths in Config

When defining route paths in configuration objects (e.g., menu items, breadcrumbs), use `FileRouteTypes['to']` from the generated route tree to constrain the `to` property.

**Bad:**

```typescript
export interface MenuItem {
  label: string;
  icon: ComponentType<{ className?: string }>;
  to: string; // Any string allowed - no type safety
}

export const MenuItems: MenuItem[] = [
  { label: "Dashboard", icon: LayoutDashboard, to: "/dashboard" },
  { label: "Clients", icon: Users, to: "/clents" }, // Typo not caught!
];
```

**Good:**

```typescript
import type { FileRouteTypes } from "@/routeTree.gen";

export interface MenuItem {
  label: string;
  icon: ComponentType<{ className?: string }>;
  to: FileRouteTypes["to"]; // Only valid route paths allowed
}

export const MenuItems: MenuItem[] = [
  { label: "Dashboard", icon: LayoutDashboard, to: "/dashboard" },
  { label: "Clients", icon: Users, to: "/clents" }, // TS error: '/clents' not assignable
];
```

The `FileRouteTypes` interface is auto-generated by TanStack Router and exposes `to` as a union of all valid route paths.

## Summary

| Task                    | Use                               |
| ----------------------- | --------------------------------- |
| Build URL string        | `router.buildLocation()`          |
| Define search params    | `validateSearch` on route         |
| Access route context    | `getRouteApi().useRouteContext()` |
| Declarative navigation  | `<Link>` component                |
| Programmatic navigation | `router.navigate()`               |
| Type-safe route paths   | `FileRouteTypes['to']`            |
